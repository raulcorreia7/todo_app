<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Center Bar Test</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/center-action-bar.css">
    <style>
        body {
            margin: 0;
            padding: 100px;
            height: 200vh;
        }
    </style>
</head>
<body>
    <div id="centerActionBar" class="center-action-bar floating-actions" role="toolbar" aria-label="Main actions">
        <div class="cab-group action-group">
            <div class="action-subgroup">
                <button id="cabSettings" class="btn btn--floating-action" aria-label="Settings" title="Settings" data-action="settings">
                    <i data-lucide="settings" class="lucide-icon" aria-hidden="true"></i>
                </button>

                <button id="cabMusic" class="btn btn--floating-action" aria-label="Music" title="Music" data-action="music">
                    <i data-lucide="music" class="lucide-icon" aria-hidden="true"></i>
                </button>

                <button id="cabSound" class="btn btn--floating-action" aria-label="Toggle Sound" title="Toggle Sound" data-action="sound" data-icon-on="volume-2" data-icon-off="volume-x">
                    <i data-lucide="volume-2" class="lucide-icon" aria-hidden="true"></i>
                </button>
            </div>

            <div class="vertical-separator" aria-hidden="true"></div>

            <div class="action-subgroup">
                <button id="cabTest" class="btn btn--floating-action btn--test" aria-label="Run Tests" title="Run Tests" data-action="test">
                    <i data-lucide="flask-conical" class="lucide-icon" aria-hidden="true"></i>
                    <span class="particle-field" aria-hidden="true"></span>
                </button>

                <button id="cabClear" class="btn btn--floating-action btn--clear" aria-label="Clear Completed" title="Clear Completed" data-action="clear">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-broom-icon lucide-broom"><path d="m13 11 9-9"/><path d="M14.6 12.6c.8.8.9 2.1.2 3L10 22l-8-8 6.4-4.8c.9-.7 2.2-.6 3 .2Z"/><path d="m6.8 10.4 6.8 6.8"/><path d="m5 17 1.4-1.4"/></svg>
                </button>

                <button id="cabDelete" class="btn btn--floating-action btn--delete" aria-label="Delete All" title="Delete All" data-action="delete">
                    <i data-lucide="trash-2" class="lucide-icon" aria-hidden="true"></i>
                </button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        // Initialize Lucide
        document.addEventListener("DOMContentLoaded", () => {
            if (typeof lucide !== "undefined") {
                lucide.createIcons();
            }
        });

        // Simple test for center bar
        class TestCenterBar {
            constructor() {
                this.debug = true;
                this._wired = false;
                this.actions = {
                    settings: this.handleSettings.bind(this),
                    sound: this.handleSound.bind(this),
                    music: this.handleMusic.bind(this),
                    test: this.handleTest.bind(this),
                    clear: this.handleClear.bind(this),
                    delete: this.handleDelete.bind(this),
                };
                this.init();
            }

            log(...args) {
                if (this.debug) console.debug('[TestCenterBar]', ...args);
            }

            handleSettings() {
                this.log('Settings clicked');
                alert('Settings clicked');
            }

            handleSound() {
                this.log('Sound clicked');
                alert('Sound clicked');
            }

            handleMusic() {
                this.log('Music clicked');
                alert('Music clicked');
            }

            handleTest() {
                this.log('Test clicked');
                alert('Test clicked');
            }

            handleClear() {
                this.log('Clear clicked');
                alert('Clear clicked');
            }

            handleDelete() {
                this.log('Delete clicked');
                alert('Delete clicked');
            }

            onClick(e) {
                this.log('onClick event triggered');
                const el = e.target?.closest?.('[data-action]');
                if (!el) {
                    this.log('No element with data-action found');
                    return;
                }
                const action = el.getAttribute('data-action');
                this.log(`Found action: ${action}`);
                if (action && this.actions[action]) {
                    this.log('Executing action:', action);
                    this.actions[action]();
                } else {
                    this.log(`No handler found for action: ${action}`);
                }
            }

            tryWireOnce() {
                const bar = document.getElementById('centerActionBar');
                if (!bar) {
                    this.log('centerActionBar not found');
                    return false;
                }

                if (!this._wired) {
                    bar.addEventListener('click', this.onClick.bind(this), false);
                    this._wired = true;
                    this.log('Event listener attached to centerActionBar');
                }

                // Check if buttons are found
                const buttons = bar.querySelectorAll('[data-action]');
                this.log(`Found ${buttons.length} buttons with data-action:`);
                buttons.forEach(btn => {
                    this.log(`  - ${btn.id}: ${btn.getAttribute('data-action')}`);
                });

                return true;
            }

            init() {
                if (this.tryWireOnce()) return;

                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', () => this.tryWireOnce(), { once: true });
                } else {
                    setTimeout(() => this.tryWireOnce(), 0);
                }
            }
        }

        // Initialize test
        new TestCenterBar();
    </script>
</body>
</html>
