<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Luxury Todo - Premium Task Management</title>

    <!-- Meta tags -->
    <meta
      name="description"
      content="Ultra-premium todo app with glass-morphism design and premium audio"
    />
    <meta name="theme-color" content="#1a1a2e" />

    <!-- Favicon -->
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%236366f1'%3E%3Cpath d='M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z'/%3E%3C/svg%3E"
    />

    <!-- Styles -->
    <link rel="stylesheet" href="styles/main.css" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&family=SF+Pro+Display:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Theme loading styles moved to styles/main.css -->
  </head>

  <body class="font-inter theme-emerald loading-theme">
    <!-- Background -->
    <div class="background-container">
      <div class="nebula-bg"></div>
      <div class="grain-overlay"></div>
    </div>

    <!-- Main App -->
    <div class="app-container">
      <!-- Header -->
      <header class="app-header">
        <div class="header-content">
          <h1 class="app-title">Luxury Todo</h1>
          <p class="daily-quote" title="Click to change quote">
            Loading daily quote...
          </p>
        </div>
      </header>

      <!-- Add Task Section -->
      <section class="add-task-section">
        <form id="addTaskForm" class="add-task-form">
          <div class="input-container">
            <input
              type="text"
              id="newTaskInput"
              class="task-input"
              placeholder="Add a new task..."
              maxlength="500"
              autocomplete="off"
            />
            <button
              type="submit"
              class="btn btn--primary add-task-btn"
              aria-label="Add task"
            >
              <i data-lucide="plus" class="lucide-icon" aria-hidden="true"></i>
            </button>
          </div>
          <textarea
            id="newTaskDescription"
            class="task-description-input"
            placeholder="Add description (optional)..."
            maxlength="500"
            rows="3"
          ></textarea>
          <div class="char-counter">
            <span id="descCounter">0/500</span>
          </div>
        </form>
      </section>

      <!-- Premium Stats Display -->
      <div class="stats-display">
        <div class="stat-card stat-total">
          <div class="stat-icon">
            <i data-lucide="list" class="lucide-icon" aria-hidden="true"></i>
          </div>
          <div class="stat-content">
            <div class="stat-label">Total</div>
            <div class="stat-value" id="headerTotalTasks">0</div>
          </div>
        </div>

        <div class="stat-card stat-completed">
          <div class="stat-icon">
            <i
              data-lucide="check-circle"
              class="lucide-icon"
              aria-hidden="true"
            ></i>
          </div>
          <div class="stat-content">
            <div class="stat-label">Done</div>
            <div class="stat-value" id="headerCompletedTasks">0</div>
          </div>
        </div>

        <div class="stat-card stat-karma">
          <div class="stat-icon">
            <i data-lucide="star" class="lucide-icon" aria-hidden="true"></i>
          </div>
          <div class="stat-content">
            <div class="stat-label">Karma</div>
            <div class="stat-value" id="headerKarmaScore">0</div>
          </div>
        </div>
      </div>

      <!-- Filters -->
      <nav class="filter-group">
        <button class="btn btn--ghost active" data-filter="all">All</button>
        <button class="btn btn--ghost" data-filter="active">Active</button>
        <button class="btn btn--ghost" data-filter="completed">
          Completed
        </button>
      </nav>

      <!-- Task List -->
      <main class="task-list-container">
        <div id="taskList" class="task-list"></div>

        <!-- Empty State -->
        <div id="emptyState" class="empty-state">
          <div class="empty-icon">
            <i data-lucide="inbox" class="lucide-icon" aria-hidden="true"></i>
          </div>
          <h3>No tasks yet</h3>
          <p>Add your first task to get started</p>
        </div>
      </main>
    </div>

    <!-- Settings Panel (Floating - single source of truth) -->
    <div
      id="settingsPanel"
      class="settings-panel"
      role="dialog"
      aria-modal="true"
      aria-labelledby="settingsTitle"
    >
      <div class="settings-header">
        <h3 id="settingsTitle">Settings</h3>
        <button
          class="close-btn"
          type="button"
          aria-label="Close settings"
          onclick="settingsManager.closeSettings()"
        >
          ×
        </button>
      </div>

      <div class="settings-content">
        <!-- Font Section -->
        <section
          class="settings-section"
          id="fontSection"
          aria-labelledby="fontTitle"
        >
          <h4 id="fontTitle">Font</h4>
          <div class="font-selector" id="fontSelector">
            <button class="font-option" data-font="inter" type="button">
              Inter
            </button>
            <button class="font-option" data-font="playfair" type="button">
              Playfair
            </button>
            <button class="font-option" data-font="sf" type="button">
              SF Pro
            </button>
          </div>
        </section>

        <!-- Sound Section -->
        <section
          class="settings-section"
          id="soundSection"
          aria-labelledby="soundTitle"
        >
          <h4 id="soundTitle">Sound</h4>
          <div class="volume-control">
            <label class="settings-checkbox">
              <input type="checkbox" id="soundToggle" />
              <span class="checkmark" aria-hidden="true"></span>
            </label>
            <div class="volume-slider-container">
              <div class="volume-fill" id="volumeFill"></div>
              <div
                class="volume-slider"
                id="volumeSlider"
                role="slider"
                aria-valuemin="0"
                aria-valuemax="100"
                aria-valuenow="50"
              ></div>
              <div class="volume-handle" id="volumeHandle"></div>
            </div>
          </div>
        </section>

        <!-- Utilities Section -->
        <section
          class="settings-section"
          id="utilitiesSection"
          aria-labelledby="utilitiesTitle"
        >
          <h4 id="utilitiesTitle">Utilities</h4>
          <div id="utilitiesContainer"></div>
        </section>

        <!-- Theme Section -->
        <section
          class="settings-section"
          id="themeSection"
          aria-labelledby="themeTitle"
        >
          <h4 id="themeTitle">Theme</h4>
          <div class="theme-selector">
            <div class="theme-cards-container" id="themeCardsContainer"></div>
          </div>
        </section>
      </div>
    </div>

    <!-- Unified Center Action Bar (single instance; wired by js/center-bar.js) -->
    <div
      id="centerActionBar"
      class="center-action-bar floating-actions"
      role="toolbar"
      aria-label="Main actions"
    >
      <div class="cab-group action-group">
        <div class="action-subgroup">
          <button
            id="cabSettings"
            class="btn btn--floating-action"
            aria-label="Settings"
            title="Settings"
            data-action="settings"
          >
            <i
              data-lucide="settings"
              class="lucide-icon"
              aria-hidden="true"
            ></i>
          </button>

          <button
            id="cabMusic"
            class="btn btn--floating-action"
            aria-label="Music"
            title="Music"
            data-action="music"
          >
            <i data-lucide="music" class="lucide-icon" aria-hidden="true"></i>
          </button>

          <button
            id="cabSound"
            class="btn btn--floating-action"
            aria-label="Toggle Sound"
            title="Toggle Sound"
            data-action="sound"
            data-icon-on="volume-2"
            data-icon-off="volume-x"
          >
            <i
              data-lucide="volume-2"
              class="lucide-icon"
              aria-hidden="true"
            ></i>
          </button>
        </div>

        <div class="vertical-separator" aria-hidden="true"></div>

        <div class="action-subgroup">
          <button
            id="cabTest"
            class="btn btn--floating-action btn--test"
            aria-label="Run Tests"
            title="Run Tests"
            data-action="test"
          >
            <i
              data-lucide="flask-conical"
              class="lucide-icon"
              aria-hidden="true"
            ></i>
            <span class="particle-field" aria-hidden="true"></span>
          </button>

          <button
            id="cabClear"
            class="btn btn--floating-action btn--clear"
            aria-label="Clear Completed"
            title="Clear Completed"
            data-action="clear"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="lucide lucide-broom-icon lucide-broom"
            >
              <path d="m13 11 9-9" />
              <path
                d="M14.6 12.6c.8.8.9 2.1.2 3L10 22l-8-8 6.4-4.8c.9-.7 2.2-.6 3 .2Z"
              />
              <path d="m6.8 10.4 6.8 6.8" />
              <path d="m5 17 1.4-1.4" />
            </svg>
          </button>

          <button
            id="cabDelete"
            class="btn btn--floating-action btn--delete"
            aria-label="Delete All"
            title="Delete All"
            data-action="delete"
          >
            <i data-lucide="trash-2" class="lucide-icon" aria-hidden="true"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Modal Overlay -->
    <div
      id="modalOverlay"
      class="modal-overlay"
      aria-hidden="true"
      style="z-index: 10050"
    ></div>

    <!-- Modal Container -->
    <div
      id="modal"
      class="modal"
      role="dialog"
      aria-modal="true"
      aria-labelledby="modalTitle"
      aria-describedby="modalDescription"
      style="z-index: 10100"
    >
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modalTitle" class="modal-title">Confirm Action</h3>
          <button class="close-btn modal-close" aria-label="Close modal">
            <i data-lucide="x" class="lucide-icon" aria-hidden="true"></i>
          </button>
        </div>
        <div class="modal-body">
          <p id="modalDescription">
            Are you sure you want to perform this action?
          </p>
        </div>
        <div class="modal-footer">
          <button id="modalCancelButton" class="btn btn--ghost">
            <i
              data-lucide="arrow-left"
              class="lucide-icon"
              aria-hidden="true"
            ></i>
            Cancel
          </button>
          <button id="modalConfirmButton" class="btn btn--primary">
            <i
              data-lucide="check-circle"
              class="lucide-icon"
              aria-hidden="true"
            ></i>
            Confirm
          </button>
        </div>
      </div>
    </div>

    <!-- App Footer -->
    <div class="app-footer">
      <p class="footer-text">
        Vibe Coded by Raúl Correia
        <span class="heart-emoji">❤️</span>
        <span class="app-version" id="appVersion"></span>
      </p>
    </div>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
      // Initialize Lucide when DOM is ready
      document.addEventListener("DOMContentLoaded", () => {
        if (typeof lucide !== "undefined") {
          lucide.createIcons();
        }
      });
    </script>

    <!-- Environment Configuration (globals/config) -->
    <script src="js/environment.js"></script>

    <!-- Scripts: Strict load order (single source of truth) -->
    <!-- 1) Core event bus -->
    <script src="js/bus.js"></script>

    <!-- 2) Core persistence and theme systems (required by others) -->
    <script src="js/storage.js"></script>
    <script src="js/themes.js"></script>

    <!-- 3) Audio/Music (used by UI, settings, and center bar actions) -->
    <script src="js/audio.js"></script>
    <script src="js/music.js"></script>
    <script src="js/music-player.js"></script>

    <!-- 4) UI/animation utilities that do not depend on app -->
    <script src="js/animations.js"></script>
    <script src="js/achievement-definitions.js"></script>
    <script src="js/gamification.js"></script>
    <script src="js/statistics.js"></script>

    <!-- 5) Modal and Settings (modal before settings so confirms work) -->
    <script src="js/modal-manager.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/settings-loader.js"></script>

    <!-- 6) Content helpers (quotes, affirmations, daily-summary) -->
    <script src="js/quotes.js"></script>
    <script src="js/affirmations.js"></script>
    <script src="js/daily-summary.js"></script>

    <!-- 7) Input UX helpers -->
    <script src="js/swipe-gestures.js"></script>
    <script src="js/nebula-parallax.js"></script>

    <!-- 8) AI providers (before app; environment already loaded above) -->
    <script src="js/ai-providers.js"></script>

    <!-- 9) UI micro modules driven by the app (center bar + tooltip) -->
    <script src="js/tooltip-service.js"></script>

    <!-- 10) UI modules that depend on the app being ready (center bar) -->
    <script src="js/center-bar.js"></script>

    <!-- 11) Main app (initializes after all deps are available) -->
    <script src="js/app.js"></script>

    <!-- 12) Version (leave last so it's harmless) -->
    <script src="js/version.js"></script>
    <script>
      // Ensure Lucide icons are hydrated for static markup (center action bar, modal, etc.)
      try {
        if (window.lucide && typeof lucide.createIcons === "function") {
          lucide.createIcons();
        }
      } catch (_) {}

      // Rehydrate icons when the app signals readiness or when tasks re-render
      document.addEventListener("app:ready", () => {
        try {
          if (window.lucide && typeof lucide.createIcons === "function")
            lucide.createIcons();
        } catch (_) {}
      });

      // Fallback: re-run on DOMContentLoaded
      document.addEventListener("DOMContentLoaded", () => {
        try {
          if (window.lucide && typeof lucide.createIcons === "function")
            lucide.createIcons();
        } catch (_) {}
      });
    </script>
  </body>
</html>
