<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Luxury Todo - Premium Task Management</title>

  <!-- Meta tags -->
  <meta name="description" content="Ultra-premium todo app with glass-morphism design and premium audio">
  <meta name="theme-color" content="#1a1a2e">

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml"
    href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%236366f1'%3E%3Cpath d='M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z'/%3E%3C/svg%3E">

  <!-- Styles -->
  <link rel="stylesheet" href="styles/design-system.css">
  <link rel="stylesheet" href="styles/luxury-base.css">
  <link rel="stylesheet" href="styles/luxury-components.css">
  <link rel="stylesheet" href="styles/modal-styles.css">
  <link rel="stylesheet" href="styles/luxury-responsive.css">
  <link rel="stylesheet" href="styles/animations.css">
  <link rel="stylesheet" href="styles/zen-achievements.css">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&family=SF+Pro+Display:wght@300;400;500;600;700&display=swap"
    rel="stylesheet">

  <!-- Theme loading styles moved to styles/luxury-base.css -->
</head>

<body class="font-inter theme-emerald loading-theme">
  <!-- Background -->
  <div class="background-container">
    <div class="nebula-bg"></div>
    <div class="grain-overlay"></div>
  </div>

  <!-- Main App -->
  <div class="app-container">
    <!-- Header -->
    <header class="app-header">
      <div class="header-content">
        <h1 class="app-title">Luxury Todo</h1>
        <p class="daily-quote" title="Click to change quote">Loading daily quote...</p>
      </div>
    </header>

    <!-- Add Task Section -->
    <section class="add-task-section">
      <form id="addTaskForm" class="add-task-form">
        <div class="input-container">
          <input type="text" id="newTaskInput" class="task-input" placeholder="Add a new task..." maxlength="500"
            autocomplete="off">
          <button type="submit" class="btn btn--primary btn--large" aria-label="Add task">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
          </button>
        </div>
        <textarea id="newTaskDescription" class="task-description-input" placeholder="Add description (optional)..."
          maxlength="500" rows="3"></textarea>
        <div class="char-counter" style="text-align: right; font-size: 0.75rem; opacity: 0.6;">
          <span id="descCounter">0/500</span>
        </div>
      </form>
    </section>

    <!-- Filters -->
    <nav class="filter-group">
      <button class="btn btn--ghost active" data-filter="all">All</button>
      <button class="btn btn--ghost" data-filter="active">Active</button>
      <button class="btn btn--ghost" data-filter="completed">Completed</button>
    </nav>

    <!-- Task List -->
    <main class="task-list-container">
      <div id="taskList" class="task-list"></div>

      <!-- Empty State -->
      <div id="emptyState" class="empty-state">
        <div class="empty-icon">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
            <path d="M9 11H5a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2z"></path>
            <path d="M19 11h-4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2z"></path>
            <path d="M5 11V7a7 7 0 0 1 14 0v4"></path>
            <path d="M12 5V2"></path>
          </svg>
        </div>
        <h3>No tasks yet</h3>
        <p>Add your first task to get started</p>
      </div>
    </main>

    <!-- Task Count -->
    <footer class="task-footer">
      <span id="taskCount">0 tasks remaining</span>
      <div class="footer-actions">
        <button id="testDataBtn" class="btn btn--subtle" data-action="test-data" title="Add test tasks">Test</button>
        <button id="clearCompleted" class="btn" data-action="clear-completed">Clear Completed</button>
        <button id="deleteAllBtn" class="btn" data-action="delete-all">Delete All</button>
      </div>
    </footer>
  </div>


  <!-- Settings Panel (static structure, sections enhanced dynamically by JS) -->
  <div id="settingsPanel" class="settings-panel">
    <div class="settings-header">
      <h3>Settings</h3>
      <button class="close-btn" onclick="settingsManager.closeSettings()">×</button>
    </div>

    <div class="settings-content">
      <!-- Font Section -->
      <div class="settings-section" id="fontSection">
        <h4>Font</h4>
        <div class="font-selector" id="fontSelector">
          <!-- Dynamically enhanced by js/settings.js -->
          <button class="font-option" data-font="inter">Inter</button>
          <button class="font-option" data-font="playfair">Playfair</button>
          <button class="font-option" data-font="sf">SF Pro</button>
        </div>
      </div>

      <!-- Sound Section -->
      <div class="settings-section" id="soundSection">
        <h4>Sound</h4>
        <div class="volume-control">
          <label class="settings-checkbox">
            <input type="checkbox" id="soundToggle" />
            <span class="checkmark" aria-hidden="true"></span>
          </label>
          <div class="volume-slider-container">
            <div class="volume-fill" id="volumeFill" style="width: 50%"></div>
            <div class="volume-slider" id="volumeSlider" role="slider" aria-valuemin="0" aria-valuemax="100" aria-valuenow="50"></div>
            <div class="volume-handle" id="volumeHandle" style="left: 50%"></div>
          </div>
        </div>
      </div>

      <!-- Utilities Section (Reset to Defaults injected/enhanced by JS) -->
      <div class="settings-section" id="utilitiesSection">
        <h4>Utilities</h4>
        <div id="utilitiesContainer">
          <!-- Reset to Defaults button will be injected here by js/settings.js with custom modal -->
        </div>
      </div>

      <!-- Theme Section (at bottom) -->
      <div class="settings-section" id="themeSection">
        <h4>Theme</h4>
        <div class="theme-selector">
          <div class="theme-cards-container" id="themeCardsContainer">
            <!-- Theme cards dynamically rendered by js/settings.js -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Floating Controls -->
  <div class="floating-controls">
    <button id="statisticsBtn" class="btn btn--floating" title="Statistics">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="20" x2="18" y2="10"></line>
        <line x1="12" y1="20" x2="12" y2="4"></line>
        <line x1="6" y1="20" x2="6" y2="14"></line>
      </svg>
    </button>

    <!-- Music Control Button (placed to the left of Settings on desktop) -->
    <button id="musicBtn" class="btn btn--floating btn--floating-audio" title="Music">
      <svg id="musicIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
        stroke-width="2">
        <path d="M9 18V5l12-2v13"></path>
        <circle cx="6" cy="18" r="3"></circle>
        <circle cx="18" cy="16" r="3"></circle>
      </svg>
    </button>

    <button id="volumeBtn" class="btn btn--floating btn--floating-audio" title="Toggle Sound">
      <svg id="volumeIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
        stroke-width="2">
        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
        <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
      </svg>
    </button>

  <!-- Music Popover -->
  <div id="musicPopover" class="music-popover" style="display:none;">
    <div class="music-transport">
      <div class="music-track-indicator" aria-live="polite">
        Track <span id="currentTrack">1</span>/<span id="totalTracks">2</span>
      </div>
      <button id="musicPrev" class="btn btn--icon" title="Previous">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 20L9 12l10-8v16z"></path>
          <line x1="5" y1="19" x2="5" y2="5"></line>
        </svg>
      </button>
      <button id="musicPlayPause" class="btn btn--icon" title="Play/Pause">
        <svg id="musicPlayIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2">
          <polygon points="5 3 19 12 5 21 5 3"></polygon>
        </svg>
        <svg id="musicPauseIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" style="display:none;">
          <rect x="6" y="4" width="4" height="16"></rect>
          <rect x="14" y="4" width="4" height="16"></rect>
        </svg>
      </button>
      <button id="musicNext" class="btn btn--icon" title="Next">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M5 4l10 8-10 8V4z"></path>
          <line x1="19" y1="5" x2="19" y2="19"></line>
        </svg>
      </button>
    </div>
    <div class="music-volume">
      <div class="music-slider-container">
        <div class="music-fill" id="musicFill" style="width: 45%"></div>
        <div class="music-slider" id="musicSlider" role="slider" aria-valuemin="0" aria-valuemax="100" aria-valuenow="45"></div>
        <div class="music-handle" id="musicHandle" style="left: 45%"></div>
        <!-- transient volume percentage feedback -->
        <div id="volumeFeedback" class="volume-feedback" aria-hidden="true"></div>
      </div>
      <!-- silence gap indicator area (conditionally shown) -->
      <div class="silence-indicator" id="silenceIndicator" style="display:none;">
        <div class="silence-progress"><div class="silence-progress-fill" id="silenceProgressFill"></div></div>
        <div class="silence-label">Next track: <span id="silenceCountdown">0:00</span></div>
      </div>
    </div>
  </div>

    <button id="settingsBtn" class="btn btn--floating" onclick="settingsManager.toggleSettings()" title="Settings">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="3"></circle>
        <path
          d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l-.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
        </path>
      </svg>
    </button>
  </div>

  <!-- Statistics Panel -->
  <div id="statisticsPanel" class="statistics-panel">
    <div class="statistics-header">
      <h3>Statistics</h3>
      <button class="close-btn" onclick="statisticsManager.closeStatistics()">×</button>
    </div>

    <div class="statistics-content">
      <div class="stats-progress-ring">
        <svg class="stats-progress-svg" viewBox="0 0 140 140">
          <circle class="stats-progress-bg" cx="70" cy="70" r="60"></circle>
          <circle id="statsProgressRing" class="stats-progress-fill" cx="70" cy="70" r="60"></circle>
        </svg>
        <div class="stats-percentage">
          <span id="statsPercentage">0%</span>
        </div>
      </div>

      <div class="stats-info">
        <div class="stat-item">
          <span class="stat-value" id="statsTotal">0</span>
          <span class="stat-label">Total</span>
        </div>
        <div class="stat-item">
          <span class="stat-value" id="statsCompleted">0</span>
          <span class="stat-label">Done</span>
        </div>
        <div class="stat-item">
          <span class="stat-value" id="statsKarma">0</span>
          <span class="stat-label">Karma</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Overlay -->
  <div id="modalOverlay" class="modal-overlay" aria-hidden="true"></div>

  <!-- Modal Container -->
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle"
    aria-describedby="modalDescription">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalTitle" class="modal-title">Confirm Action</h3>
        <button class="close-btn modal-close" aria-label="Close modal">×</button>
      </div>
      <div class="modal-body">
        <p id="modalDescription">Are you sure you want to perform this action?</p>
      </div>
      <div class="modal-footer">
        <button id="modalCancelButton" class="btn btn--ghost">Cancel</button>
        <button id="modalConfirmButton" class="btn btn--primary">Confirm</button>
      </div>
    </div>
  </div>

  <!-- App Footer -->
  <div class="app-footer">
    <p class="footer-text">
      Vibe Coded by Raúl Correia
      <span class="heart-emoji">❤️</span>
      with <span class="llm-name">Kimi K2 and GLM-4.5 Air</span>
      <span class="app-version" id="appVersion"></span>
    </p>
  </div>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <script>
    // Initialize Lucide when DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
      if (typeof lucide !== 'undefined') {
        lucide.createIcons();
      }
    });
  </script>

  <!-- Version Script -->
  <script src="js/version.js"></script>

  <!-- Environment Configuration -->
  <script src="js/environment.js"></script>

  <!-- Scripts -->
  <script src="js/bus.js"></script>
  <script src="js/storage.js"></script>
  <script src="js/themes.js"></script>
  <script src="js/audio.js"></script>
  <script src="js/music.js"></script>
  <script src="js/music-visualizer.js"></script>
  <script src="js/animations.js"></script>
  <script src="js/achievement-definitions.js"></script>
  <script src="js/gamification.js"></script>
  <script src="js/statistics.js"></script>

  <!-- Ensure modal-manager is available before settings.js so the custom confirm is ready -->
  <script src="js/modal-manager.js"></script>

  <script src="js/settings.js"></script>
  <script src="js/settings-loader.js"></script>
  <script src="js/quotes.js"></script>
  <script src="js/affirmations.js"></script>
  <script src="js/daily-summary.js"></script>
  <script src="js/swipe-gestures.js"></script>
  <script src="js/nebula-parallax.js"></script>
  <script src="js/ai-providers.js"></script>
  <script src="js/app.js"></script>
  <script>
    // Align music popover centered above the music button at runtime
    (function() {
      function positionMusicPopover() {
        const pop = document.getElementById('musicPopover');
        const btn = document.getElementById('musicBtn');
        if (!pop || !btn) return;

        const btnRect = btn.getBoundingClientRect();
        const popRect = pop.getBoundingClientRect();

        // Center popover horizontally on the music button
        const centerX = btnRect.left + (btnRect.width / 2);
        const left = Math.max(8, Math.min(window.innerWidth - popRect.width - 8, centerX - popRect.width / 2));

        // Place above the button with 10px margin
        const bottom = Math.max(8, window.innerHeight - btnRect.top + 10);

        pop.style.left = `${left + popRect.width / 2}px`; // will be adjusted by translateX(-50%)
        pop.style.bottom = `${bottom}px`;
      }

      // Reposition when opening
      document.addEventListener('click', (e) => {
        if (e.target.closest('#musicBtn')) {
          setTimeout(positionMusicPopover, 0);
        }
      });

      // Reposition on resize and orientation changes
      window.addEventListener('resize', positionMusicPopover);
      window.addEventListener('orientationchange', () => setTimeout(positionMusicPopover, 200));
    })();
  </script>

  <!-- Mobile touch optimization script -->
  <script>
  // Mobile touch optimization - ensure proper scrolling behavior
  (function() {
    // Add touch-action CSS to ensure proper scrolling
    const style = document.createElement('style');
    style.textContent = `
      /* Ensure proper touch scrolling for mobile devices */
      .task-list-container {
        touch-action: pan-y;
        -webkit-overflow-scrolling: touch;
        overflow-y: auto;
        flex: 1;
        min-height: 200px;
      }
      
      .app-container {
        height: 100vh;
        overflow-y: auto;
        overflow-x: hidden;
        display: flex;
        flex-direction: column;
        touch-action: pan-y;
      }
      
      /* Prevent text selection during swipe gestures */
      .task-item {
        user-select: none;
        -webkit-user-select: none;
        touch-action: pan-y;
      }
      
      /* Allow scrolling on the main container */
      body {
        overflow-x: hidden;
        touch-action: pan-y;
        height: 100vh;
        margin: 0;
        padding: 0;
      }
      
      /* Ensure footer is always accessible */
      .app-footer {
        margin-top: auto;
        background: var(--glass-color);
        backdrop-filter: blur(var(--glass-blur));
        border-top: 1px solid var(--border-color);
        padding: 1rem;
        text-align: center;
      }
      
      /* Make sure the task list can grow but not restrict full page scrolling */
      .task-list {
        min-height: 100px;
      }
      
      /* Mobile-specific adjustments */
      @media (max-width: 768px) {
        .app-container {
          height: 100vh;
          overflow-y: auto;
        }
        
        .task-list-container {
          min-height: 300px;
        }
        
        /* Ensure footer is visible at bottom */
        .app-footer {
          position: sticky;
          bottom: 0;
          z-index: 100;
        }
      }
    `;
    document.head.appendChild(style);
    
    // Optimize touch event listeners for better mobile scrolling
    document.addEventListener('touchmove', function(e) {
      // Allow vertical scrolling by default
      if (e.touches.length === 1) {
        const touch = e.touches[0];
        const target = e.target;
        
        // Check if we're scrolling vertically
        if (Math.abs(touch.movementY) > Math.abs(touch.movementX)) {
          // Allow vertical scrolling
          return;
        }
      }
    }, { passive: true });
    
    // Prevent double-tap zoom on mobile
    let lastTouchEnd = 0;
    document.addEventListener('touchend', function(e) {
      const now = Date.now();
      if (now - lastTouchEnd <= 300) {
        e.preventDefault();
      }
      lastTouchEnd = now;
    }, false);
    
    // Ensure proper scrolling behavior for task list
    const taskListContainer = document.querySelector('.task-list-container');
    if (taskListContainer) {
      taskListContainer.addEventListener('touchstart', function(e) {
        // Store the initial touch position
        this.startY = e.touches[0].clientY;
      }, { passive: true });
      
      taskListContainer.addEventListener('touchmove', function(e) {
        if (!this.startY) return;
        
        const touch = e.touches[0];
        const deltaY = touch.clientY - this.startY;
        
        // If we're scrolling vertically, allow it
        if (Math.abs(deltaY) > 10) {
          e.preventDefault();
        }
      }, { passive: false });
    }
    
    // Ensure the app container can scroll to reveal footer
    const appContainer = document.querySelector('.app-container');
    if (appContainer) {
      appContainer.addEventListener('scroll', function() {
        // Ensure footer is always accessible
        const footer = document.querySelector('.app-footer');
        if (footer) {
          const scrollPosition = this.scrollTop + this.clientHeight;
          const documentHeight = this.scrollHeight;
          
          // Show footer when we're near the bottom
          if (scrollPosition >= documentHeight - 100) {
            footer.style.opacity = '1';
            footer.style.visibility = 'visible';
          }
        }
      }, { passive: true });
    }
  })();
  </script>

  <style>
/* Ensure order: statistics, music, volume, settings on wide viewports */
@media (min-width: 900px) {
  .floating-controls {
    display: grid;
    grid-auto-flow: column;
    gap: 12px;
    align-items: end;
  }
  #statisticsBtn { order: 1; }
  #musicBtn { order: 2; }
  #volumeBtn { order: 3; }
  #settingsBtn { order: 4; }
}

/* Shared styles for audio floating buttons (music + volume) */
.btn--floating.btn--floating-audio {
  /* pulse when enabled (not muted) handled by existing JS that adds enabled class on volume; we mirror with is-playing on music */
  --btn-size: 44px;
}
#volumeBtn.btn--floating-audio.enabled,
#musicBtn.btn--floating-audio.is-playing {
  animation: pulseGlow 2.4s ease-in-out infinite;
}
#volumeBtn.btn--floating-audio.disabled,
#musicBtn.btn--floating-audio.muted {
  animation: none;
}
#volumeBtn.btn--floating-audio.buffering::before,
#musicBtn.btn--floating-audio.buffering::before {
  content: '';
  position: absolute;
  width: 16px; height: 16px;
  border: 2px solid transparent;
  border-top-color: var(--accent-color);
  border-radius: 50%;
  right: 6px; top: 6px;
  animation: spin 1s linear infinite;
}
#volumeBtn.btn--floating-audio.disabled,
#musicBtn.btn--floating-audio.music-disabled { opacity: 0.85; }

/* Removed visualizer header and bars for minimalist popover */

/* Micro equalizer on button */
#musicBtn.is-playing::after {
  content: '';
  position: absolute;
  right: 6px; bottom: 6px;
  width: 12px; height: 6px;
  background:
    linear-gradient(90deg, var(--accent-color), var(--glow-color));
  -webkit-mask:
    radial-gradient(circle 1px at 2px 50%, #000 99%, transparent 100%),
    radial-gradient(circle 1px at 6px 50%, #000 99%, transparent 100%),
    radial-gradient(circle 1px at 10px 50%, #000 99%, transparent 100%);
  mask:
    radial-gradient(circle 1px at 2px 50%, #000 99%, transparent 100%),
    radial-gradient(circle 1px at 6px 50%, #000 99%, transparent 100%),
    radial-gradient(circle 1px at 10px 50%, #000 99%, transparent 100%);
  filter: drop-shadow(0 0 6px var(--glow-color));
  opacity: 0.85;
  animation: microPulse 2.4s ease-in-out infinite;
}
#musicBtn.muted.is-playing::after,
#musicBtn.buffering.is-playing::after,
#musicBtn.silence.is-playing::after,
#musicBtn.music-disabled.is-playing::after { opacity: 0.25; animation-play-state: paused; }

@keyframes microPulse {
  0%,100% { transform: translateZ(0) scaleY(1); }
  50% { transform: translateZ(0) scaleY(1.2); }
}

/* Music popover styling - reuse design tokens */
.music-popover {
  position: fixed;
  background: var(--glass-color);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  backdrop-filter: blur(var(--glass-blur));
  box-shadow: 0 6px 20px var(--shadow-color);
  padding: 16px; /* more premium spacing */
  z-index: 1000;
  min-width: 280px; /* wider for luxury proportions */
  transition: transform 140ms ease, opacity 140ms ease, height 140ms ease;
  transform-origin: bottom center;
  display: grid;
  grid-template-rows: auto auto; /* transport, slider */
  gap: 44px; /* extra separation between transport/track status and volume */

  /* Centered above the music button by default */
  left: 50%;
  transform: translateX(-50%) scale(1);
  bottom: 86px; /* increase vertical offset for breathing room */
}
.music-popover.sticky { pointer-events: auto; }
.music-popover.above { transform-origin: bottom center; }
.music-popover.below { transform-origin: top center; }
.music-popover.open { opacity: 1; transform: translateX(-50%) scale(1); }
.music-popover:not(.open) { opacity: 0; transform: translateX(-50%) scale(0.98); }

.music-transport {
  position: relative;
  display: flex;
  gap: 18px; /* slightly wider spacing between buttons */
  justify-content: center;
  align-items: center;
  margin-bottom: 6px; /* add breathing room above track indicator */
}

/* Subtle playing feedback on play/pause control inside popover */
#musicPlayPause.is-playing {
  position: relative;
}
#musicPlayPause.is-playing::after {
  content: '';
  position: absolute;
  inset: -6px;
  border-radius: 12px;
  background: radial-gradient(60% 60% at 50% 50%, color-mix(in oklab, var(--accent-color) 45%, transparent), transparent 70%);
  filter: drop-shadow(0 0 8px color-mix(in oklab, var(--glow-color) 55%, transparent));
  animation: playBtnPulse 2.6s ease-in-out infinite;
  pointer-events: none;
}
@keyframes playBtnPulse {
  0%, 100% { opacity: 0.45; transform: scale(1); }
  50% { opacity: 0.9; transform: scale(1.06); }
}

/* minimalist track indicator */
.music-track-indicator {
  position: absolute;
  bottom: -22px; /* move indicator farther from buttons */
  left: 50%;
  transform: translateX(-50%);
  font-size: 0.9rem; /* slightly larger for readability */
  opacity: 0.78;
  color: var(--text-secondary, #fff);
  transition: opacity 160ms ease, transform 160ms ease;
  pointer-events: none;
}
.music-track-indicator.highlight {
  opacity: 1;
  transform: translateX(-50%) translateY(-2px);
}

.music-volume {
  display: flex;
  align-items: center;
  gap: 14px;
  padding-top: 16px; /* more separation from track indicator */
}

/* label removed for minimalist design */

.music-slider-container {
  flex: 1;
  position: relative;
}

/* transient volume percentage chip */
.volume-feedback {
  position: absolute;
  top: -26px;
  transform: translateX(-50%);
  padding: 4px 8px;
  font-size: 0.8rem;
  color: var(--text-primary, #fff);
  background: color-mix(in oklab, var(--glass-color) 80%, transparent);
  border: 1px solid var(--border-color);
  border-radius: 6px;
  box-shadow: 0 4px 12px var(--shadow-color);
  opacity: 0;
  transition: opacity 140ms ease, transform 140ms ease;
  will-change: opacity, transform;
  pointer-events: none;
}
.volume-feedback.show {
  opacity: 0.95;
  transform: translateX(-50%) translateY(-2px);
}

/* silence gap indicator */
.silence-indicator {
  display: grid;
  grid-template-columns: 1fr auto;
  align-items: center;
  gap: 12px;
  margin-top: 14px; /* more space between slider and silence row */
}
.silence-progress {
  height: 6px;
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 999px;
  overflow: hidden;
}
.silence-progress-fill {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, var(--accent-color), var(--glow-color));
  box-shadow: 0 0 6px var(--glow-color);
  border-radius: 999px;
  transition: width 300ms linear;
}
.silence-label {
  font-size: 0.8rem;
  opacity: 0.75;
}

.music-slider {
  width: 100%;
  height: 8px; /* more substantial track */
  background: rgba(255,255,255,0.1);
  border-radius: 6px;
  position: relative;
  cursor: pointer;
  border: 1px solid rgba(255,255,255,0.12);
}

.music-fill {
  height: 100%;
  width: 45%;
  background: linear-gradient(90deg, var(--accent-color), var(--glow-color));
  border-radius: 4px;
  box-shadow: 0 0 8px var(--glow-color);
}

.music-handle {
  position: absolute;
  top: 50%;
  transform: translate(-50%,-50%);
  width: 20px; /* premium handle size */
  height: 20px;
  background: var(--glass-color);
  border: 2px solid var(--accent-color);
  border-radius: 50%;
  box-shadow: 0 0 10px var(--glow-color);
}

/* Music button subtle states */
#musicBtn.muted::after {
  content: '';
  position: absolute;
  width: 60%;
  height: 2px;
  background: var(--accent-color);
  left: 50%;
  top: 50%;
  transform: translate(-50%,-50%) rotate(45deg);
  border-radius: 2px;
  box-shadow: 0 0 8px var(--glow-color);
}

/* Subtle playing feedback on floating music button (no text, premium) */
#musicBtn.is-playing {
  position: relative;
  isolation: isolate; /* ensure pseudo-elements layer correctly */
}

/* Core breathing halo (kept subtle) */
#musicBtn.is-playing::before {
  content: '';
  position: absolute;
  top: 50%; left: 50%;
  width: 110%; height: 110%;
  transform: translate(-50%, -50%);
  border-radius: 50%;
  background:
    radial-gradient(50% 50% at 50% 50%, color-mix(in oklab, var(--accent-color) 28%, transparent), transparent 70%),
    radial-gradient(70% 70% at 50% 50%, color-mix(in oklab, var(--glow-color) 10%, transparent), transparent 80%);
  box-shadow:
    0 0 10px color-mix(in oklab, var(--glow-color) 30%, transparent),
    0 0 22px color-mix(in oklab, var(--accent-color) 18%, transparent);
  animation: musicCorePulse 4.5s ease-in-out infinite;
  z-index: -1;
  pointer-events: none;
}

/* Orbital Mandala: three concentric orbits with phased dots */
#musicBtn.is-playing::after {
  content: '';
  position: absolute;
  top: 50%; left: 50%;
  width: 150%; height: 150%; /* larger canvas to accommodate outer orbit */
  transform: translate(-50%, -50%);
  border-radius: 50%;
  pointer-events: none;
  z-index: -2;
  /* we use multiple conic gradients to simulate orbiting light with phase offsets */
  background:
    /* inner ring dots */
    conic-gradient(from 0deg, color-mix(in oklab, var(--glow-color) 70%, transparent) 0 2deg, transparent 2deg 360deg),
    conic-gradient(from 120deg, color-mix(in oklab, var(--glow-color) 55%, transparent) 0 2deg, transparent 2deg 360deg),
    conic-gradient(from 240deg, color-mix(in oklab, var(--glow-color) 55%, transparent) 0 2deg, transparent 2deg 360deg),
    /* middle ring dots */
    conic-gradient(from 60deg, color-mix(in oklab, var(--accent-color) 55%, transparent) 0 2deg, transparent 2deg 360deg),
    conic-gradient(from 180deg, color-mix(in oklab, var(--accent-color) 45%, transparent) 0 2deg, transparent 2deg 360deg),
    conic-gradient(from 300deg, color-mix(in oklab, var(--accent-color) 45%, transparent) 0 2deg, transparent 2deg 360deg),
    /* outer ring dots */
    conic-gradient(from 90deg, color-mix(in oklab, var(--glow-color) 40%, transparent) 0 2deg, transparent 2deg 360deg),
    conic-gradient(from 210deg, color-mix(in oklab, var(--glow-color) 35%, transparent) 0 2deg, transparent 2deg 360deg),
    conic-gradient(from 330deg, color-mix(in oklab, var(--glow-color) 35%, transparent) 0 2deg, transparent 2deg 360deg);
  mask:
    radial-gradient(circle at 50% 50%, transparent 0 30%, #000 30% 35%, transparent 35%),
    radial-gradient(circle at 50% 50%, transparent 0 47%, #000 47% 52%, transparent 52%),
    radial-gradient(circle at 50% 50%, transparent 0 64%, #000 64% 69%, transparent 69%);
  -webkit-mask:
    radial-gradient(circle at 50% 50%, transparent 0 30%, #000 30% 35%, transparent 35%),
    radial-gradient(circle at 50% 50%, transparent 0 47%, #000 47% 52%, transparent 52%),
    radial-gradient(circle at 50% 50%, transparent 0 64%, #000 64% 69%, transparent 69%);
  animation: orbitInner 6s linear infinite, orbitMid 9s linear infinite, orbitOuter 12s linear infinite;
}

/* halo breathe */
@keyframes musicCorePulse {
  0%, 100% { opacity: 0.55; transform: translate(-50%, -50%) scale(1); }
  50% { opacity: 0.9; transform: translate(-50%, -50%) scale(1.06); }
}

/* concentric ring rotations (layered via multiple animations) */
@keyframes orbitInner {
  0% { transform: translate(-50%, -50%) rotate(0deg); }
  100% { transform: translate(-50%, -50%) rotate(360deg); }
}
@keyframes orbitMid {
  0% { transform: translate(-50%, -50%) rotate(0deg); }
  100% { transform: translate(-50%, -50%) rotate(-360deg); }
}
@keyframes orbitOuter {
  0% { transform: translate(-50%, -50%) rotate(0deg); }
  100% { transform: translate(-50%, -50%) rotate(360deg); }
}

#musicBtn.hint { /* tips removed; keep class for compatibility but no effect */ }
#musicBtn.buffering {
  position: relative;
}
#musicBtn.buffering::before {
  content: '';
  position: absolute;
  width: 16px; height: 16px;
  border: 2px solid transparent;
  border-top-color: var(--accent-color);
  border-radius: 50%;
  right: 6px; top: 6px;
  animation: spin 1s linear infinite;
}
#musicBtn.silence { opacity: 0.9; }

/* buffering overlay on transport */
.music-transport.buffering::after {
  content: '';
  position: absolute;
  width: 22px; height: 22px;
  border: 2px solid transparent;
  border-top-color: var(--accent-color);
  border-radius: 50%;
  right: -6px; top: -6px;
  animation: spin 1s linear infinite;
  opacity: 0.9;
}

@keyframes spin { to { transform: rotate(360deg); } }
  </style>
</body>

</html>
